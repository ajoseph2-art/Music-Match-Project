{% extends 'base.html' %}

{% block title %}Recommendations - MusicMatch{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="display-4">Music Recommendations</h1>
        <p class="lead">Get personalized recommendations based on your activity and preferences</p>
    </div>
</div>

<!-- Filters -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h3><i class="bi bi-sliders"></i> Filter Recommendations</h3>
            </div>
            <div class="card-body">
                <form method="get" class="row g-3">
                    <!-- Activity Mode -->
                    <div class="col-md-4">
                        <label for="mode" class="form-label">Activity Mode</label>
                        <select name="mode" id="mode" class="form-select">
                            <option value="">All Modes</option>
                            {% for mode in modes %}
                            <option value="{{ mode.id }}" {% if selected_mode.id == mode.id %}selected{% endif %}>
                                {{ mode.get_name_display }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <!-- Genre -->
                    <div class="col-md-4">
                        <label for="genre" class="form-label">Genre</label>
                        <input type="text" name="genre" id="genre" class="form-control" placeholder="e.g., Rock, Pop" value="{{ genre }}">
                    </div>
                    
                    <!-- Danceability -->
                    <div class="col-md-2">
                        <label for="min_danceability" class="form-label">Min Danceability</label>
                        <input type="number" name="min_danceability" id="min_danceability" class="form-control" 
                               min="0" max="1" step="0.1" placeholder="0.0" value="{{ min_danceability }}">
                    </div>
                    
                    <div class="col-md-2">
                        <label for="max_danceability" class="form-label">Max Danceability</label>
                        <input type="number" name="max_danceability" id="max_danceability" class="form-control" 
                               min="0" max="1" step="0.1" placeholder="1.0" value="{{ max_danceability }}">
                    </div>
                    
                    <!-- Energy -->
                    <div class="col-md-2">
                        <label for="min_energy" class="form-label">Min Energy</label>
                        <input type="number" name="min_energy" id="min_energy" class="form-control" 
                               min="0" max="1" step="0.1" placeholder="0.0" value="{{ min_energy }}">
                    </div>
                    
                    <div class="col-md-2">
                        <label for="max_energy" class="form-label">Max Energy</label>
                        <input type="number" name="max_energy" id="max_energy" class="form-control" 
                               min="0" max="1" step="0.1" placeholder="1.0" value="{{ max_energy }}">
                    </div>
                    
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-search"></i> Get Recommendations
                        </button>
                        <a href="{% url 'recommendations' %}" class="btn btn-outline-secondary">Clear Filters</a>
                        <a href="{% url 'discovery_swipe' %}" class="btn btn-success float-end">
                            <i class="bi bi-arrow-left-right"></i> Discovery Swipe Mode
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Recommendations -->
<div class="row">
    {% if songs %}
    {% for song in songs %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title">{{ song.name }}</h5>
                <p class="card-text text-muted">by <strong>{{ song.artist }}</strong></p>
                {% if song.album %}
                <p class="card-text small"><em>{{ song.album }}</em></p>
                {% endif %}
                
                {% if song.genre %}
                <span class="badge bg-secondary mb-2">{{ song.genre }}</span>
                {% endif %}
                
                <div class="mt-3">
                    {% if song.danceability is not None %}
                    <div class="mb-2">
                        <small class="text-muted">Danceability:</small>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar" role="progressbar" style="width: {{ song.danceability|floatformat:0 }}%"></div>
                        </div>
                        <small>{{ song.danceability|floatformat:2 }}</small>
                    </div>
                    {% endif %}
                    
                    {% if song.energy is not None %}
                    <div class="mb-2">
                        <small class="text-muted">Energy:</small>
                        <div class="progress" style="height: 10px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: {{ song.energy|floatformat:0 }}%"></div>
                        </div>
                        <small>{{ song.energy|floatformat:2 }}</small>
                    </div>
                    {% endif %}
                </div>
            </div>
            <div class="card-footer">
                {% if song.spotify_url %}
                <a href="{{ song.spotify_url }}" target="_blank" class="btn btn-sm btn-success">
                    <i class="bi bi-spotify"></i> Open in Spotify
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="col-12">
        <div class="alert alert-info">
            <h4>No recommendations found</h4>
            <p>Try adjusting your filters or check back later when more songs are added to the database.</p>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

